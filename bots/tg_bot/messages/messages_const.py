from typing import Any

from tinkoff.invest import PortfolioResponse, FavoriteInstrument
from tinkoff.invest.utils import money_to_decimal as m2d
from tinkoff.invest.utils import quotation_to_decimal as q2d

from database.pgsql.models import Instrument

START_TEXT = (
    "<b>–ü—Ä–∏–≤–µ—Ç!</b> –Ø <b>TradingTMasterBot</b> üêçüìà\n\n"
    "–ü–æ–º–æ–≥–∞—é —Ä–∞–±–æ—Ç–∞—Ç—å —Å –¢–∏–Ω—å–∫–æ—Ñ—Ñ –ò–Ω–≤–µ—Å—Ç–∏—Ü–∏—è–º–∏: –¥–æ–±–∞–≤–ª—è—é –∞–∫–∫–∞—É–Ω—Ç, "
    "–ø–æ–ª—É—á–∞—é –ø–æ—Ä—Ç—Ñ–µ–ª—å, —Å—á–∏—Ç–∞—é –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä—ã (Donchian, ATR) –∏ –ø—Ä–∏—Å—ã–ª–∞—é –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Ü–µ–Ω.\n\n"
    "–û—Ç–∫—Ä–æ–π –º–µ–Ω—é –∫–æ–º–∞–Ω–¥ –∏–ª–∏ –Ω–∞–ø–∏—à–∏ <code>/help</code>, —á—Ç–æ–±—ã –ø–æ—Å–º–æ—Ç—Ä–µ—Ç—å –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏."
)

HELP_TEXT = (
    "<b>–°–ø—Ä–∞–≤–∫–∞</b>\n\n"
    "<b>–û—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã:</b>\n"
    "‚Ä¢ <code>/start</code> ‚Äî –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ –∏ –∫—Ä–∞—Ç–∫–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –±–æ—Ç–µ.\n"
    "‚Ä¢ <code>/help</code> ‚Äî —ç—Ç–∞ —Å–ø—Ä–∞–≤–∫–∞.\n\n"
    "<b>–ê–∫–∫–∞—É–Ω—Ç—ã:</b>\n"
    "‚Ä¢ <code>/add_account_check</code> ‚Äî –≤—ã–±—Ä–∞—Ç—å –∏ –¥–æ–±–∞–≤–∏—Ç—å –∞–∫–∫–∞—É–Ω—Ç –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è.\n"
    "‚Ä¢ <code>/remove_account_check</code> ‚Äî —É–¥–∞–ª–∏—Ç—å —Ä–∞–Ω–µ–µ –¥–æ–±–∞–≤–ª–µ–Ω–Ω—ã–π –∞–∫–∫–∞—É–Ω—Ç.\n"
    "‚Ä¢ <code>/add_instruments_for_check</code> ‚Äî –î–æ–±–∞–≤–∏—Ç—å –∏–∑–±—Ä–∞–Ω–Ω—ã–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è.\n\n"
    "<b>–ß—Ç–æ –¥–µ–ª–∞–µ—Ç –±–æ—Ç –ø—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ –∞–∫–∫–∞—É–Ω—Ç–∞</b>:\n"
    "1) –ó–∞–≥—Ä—É–∂–∞–µ—Ç –ø–æ—Ä—Ç—Ñ–µ–ª—å –∏ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã –≤ –±–∞–∑—É.\n"
    "2) –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä—ã: Donchian 55/20 –∏ ATR(14).\n"
    "3) –ü–æ–¥–ø–∏—Å—ã–≤–∞–µ—Ç—Å—è –Ω–∞ –ª–µ–Ω—Ç—É —Ü–µ–Ω (last_price) –ø–æ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞–º –∏–∑ –ø–æ—Ä—Ç—Ñ–µ–ª—è.\n\n"
    "<b>–ü–æ–¥—Å–∫–∞–∑–∫–∏:</b>\n"
    "‚Ä¢ –ï—Å–ª–∏ –Ω—É–∂–Ω–æ –æ—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –æ–±—Ä–∞–±–æ—Ç–∫—É —Ç–µ–∫—É—â–µ–π –∫–æ–º–∞–Ω–¥—ã ‚Äî –ø—Ä–æ—Å—Ç–æ –æ—Ç–ø—Ä–∞–≤—å <i>–û—Ç–º–µ–Ω–µ–Ω–æ</i> —á–µ—Ä–µ–∑ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â—É—é –∫–Ω–æ–ø–∫—É –∏–ª–∏ –Ω–∞—á–Ω–∏ –∑–∞–Ω–æ–≤–æ.\n"
    "‚Ä¢ –°–æ–æ–±—â–µ–Ω–∏—è —Ñ–æ—Ä–º–∞—Ç–∞ –∏ –∫–Ω–æ–ø–∫–∏ –ø–æ—è–≤–ª—è—é—Ç—Å—è –ø–æ —Ö–æ–¥—É —Å—Ü–µ–Ω–∞—Ä–∏—è ‚Äî —Å–ª–µ–¥—É–π –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è–º –±–æ—Ç–∞.\n\n"
    "<b>–¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏</b>:\n"
    "‚Äî –ë—ç–∫ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç aiogram v3 –∏ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π –∫–ª–∏–µ–Ω—Ç –¢–∏–Ω—å–∫–æ—Ñ—Ñ.\n"
    "‚Äî –î–∞–Ω–Ω—ã–µ —Ö—Ä–∞–Ω—è—Ç—Å—è –≤ –ë–î; –≤—ã—á–∏—Å–ª–µ–Ω–∏—è –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–æ–≤ –¥–µ–ª–∞—é—Ç—Å—è –ø–æ –∑–∞–≤–µ—Ä—à—ë–Ω–Ω—ã–º —Å–≤–µ—á–∞–º.\n"
)


def text_add_account_message(indicators: list[dict[str, Any]]) -> str:
    return (f"–ê–∫–∫–∞—É–Ω—Ç —É—Å–ø–µ—à–Ω–æ –¥–æ–±–∞–≤–ª–µ–Ω. –ù–∞—á–∏–Ω–∞–µ–º —Å–ª–µ–¥–∏—Ç—å –∑–∞ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞–º–∏:\n"
            f"{'\n'.join(f"{i['ticker']} - {i['direction']}" for i in indicators)}")


def text_delete_account_message(portfolio: PortfolioResponse) -> str:
    return (f"–ê–∫–∫–∞—É–Ω—Ç —É—Å–ø–µ—à–Ω–æ —É–¥–∞–ª–µ–Ω. –£–¥–∞–ª–µ–Ω—ã –ø–æ–¥–ø–∏—Å–∫–∏ –Ω–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–µ —Ü–µ–Ω—ã:\n"
            f"{'\n'.join(f"<b>{p.ticker}</b>" for p in portfolio.positions)}")


def text_add_favorites_instruments(instruments: list[Instrument]) -> str:
    return (f"–ù–∞—á–∏–Ω–∞–µ–º —Å–ª–µ–¥–∏—Ç—å –∑–∞ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞–º–∏:\n"
            f"{'\n'.join(f"‚úÖ <b>{i.ticker}</b>" for i in instruments)}")


def text_uncheck_favorites_instruments(instruments: list[Instrument]) -> str:
    return (f"–ü–µ—Ä–µ—Å—Ç–∞–µ–º —Å–ª–µ–¥–∏—Ç—å –∑–∞ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞–º–∏:\n"
            f"{'\n'.join(f"‚úÖ <b>{i.ticker}</b>" for i in instruments)}")
